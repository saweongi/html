package ch14_jdbc_conn.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import ch14_jdbc_conn.model.BbsVO;
import ch14_jdbc_conn.model.UserVO;

//DB에 사용되는 부분을 작성
public class UserDao {
	private static UserDao instance = new UserDao();
	public static UserDao getInstance() {
		return instance;
	}
	
	//회원 조회 로그인 관련
	public UserVO loginUser(Connection conn, String id) throws SQLException {
		UserVO userVO = new UserVO();
		StringBuffer query = new StringBuffer();
		query.append(" SELECT USER_ID");
		query.append("	,USER_PW");
		query.append("	,USER_NM");
		query.append("	,USER_MAIL");
		query.append("	,USER_MILEAGE");
		query.append(" FROM tb_user");
		query.append(" where user_id = ?");
		PreparedStatement ps = conn.prepareStatement(query.toString());
		ps.setString(1, id);
		ResultSet rs = ps.executeQuery();
		while(rs.next()) {
			userVO.setUserId(rs.getString("user_id"));
			userVO.setUserNm(rs.getString("user_nm"));
			userVO.setUserPw(rs.getString("user_pw"));
			userVO.setUserMileage(rs.getInt("user_mileage"));
		}
		if(ps !=null)ps.close();
		if(rs != null)rs.close();
		return userVO;
	}
	public BbsVO loginUser(Connection conn, String id) throws SQLException {
		BbsVO bbsVO= new BbsVO();
		StringBuffer query = new StringBuffer();
		query.append(" SELECT USER_ID");
		query.append("	,USER_PW");
		query.append("	,USER_NM");
		query.append("	,USER_MAIL");
		query.append("	,USER_MILEAGE");
		query.append(" FROM tb_user");
		query.append(" where user_id = ?");
		PreparedStatement ps = conn.prepareStatement(query.toString());
		ps.setString(1, id);
		ResultSet rs = ps.executeQuery();
		while(rs.next()) {
			bbsVO.setBbsNo(rs.getString("user_nm"));
			bbsVO.setParentNo(rs.getString("user_nm"));
			bbsVO.setBbsTitle(rs.getString("user_nm"));
			bbsVO.setBbsContent(rs.getString("user_nm"));
			bbsVO.setAuthorId(rs.getString("user_nm"));
			bbsVO.setCreateDt(rs.getString("user_nm"));
			bbsVO.setUpdateDt(rs.getString("user_nm"));
		}
		if(ps !=null)ps.close();
		if(rs != null)rs.close();
		return bbsVO;
	}
	
	
	// 회원가입 (INSERT)
    public int insertUser(Connection conn, UserVO user) throws SQLException {
        StringBuffer query = new StringBuffer();
        query.append(" INSERT INTO tb_user (user_id, user_nm, user_pw, create_dt)");
        query.append(" VALUES (?,?,?, SYSDATE)");
        PreparedStatement ps = conn.prepareStatement(query.toString());
        int idx = 1;
        ps.setString(idx++, user.getUserId());
        ps.setString(idx++, user.getUserPw());
        ps.setString(idx++, user.getUserNm());
        int cnt = ps.executeUpdate();
        if(ps!=null)ps.close();
        return cnt;
    }
}
